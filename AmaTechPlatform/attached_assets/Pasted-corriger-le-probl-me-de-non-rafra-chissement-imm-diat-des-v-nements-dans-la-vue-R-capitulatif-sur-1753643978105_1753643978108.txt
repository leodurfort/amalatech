corriger le problÃ¨me de non-rafraÃ®chissement immÃ©diat des Ã©vÃ©nements dans la vue "RÃ©capitulatif" sur la page Roadshow dâ€™AmaTech.

ğŸ§  Contexte
Tu as deux onglets : Vue tableau et RÃ©capitulatif

Quand tu ajoutes une interaction / statut / relance dans Vue tableau, le RÃ©capitulatif ne se met pas Ã  jour Ã  chaud

Il faut donc forcer un refetch() des donnÃ©es lors du changement dâ€™onglet

âœ… HypothÃ¨se : tu utilises SWR (trÃ¨s probable d'aprÃ¨s les mutate() dÃ©jÃ  prÃ©sents)
ğŸ§± Backend : inchangÃ©
Tu as dÃ©jÃ  un endpoint /api/roadshow/[projectId]/events?week=30&year=2025, rien Ã  modifier cÃ´tÃ© serveur.

ğŸ§‘â€ğŸ’» Frontend â€” Ã‰tapes Ã  appliquer
1. ğŸ¯ Composant parent RoadshowPage.tsx (ou Ã©quivalent)
Ajoute la gestion de lâ€™onglet actif avec un state local :

tsx
Copier
Modifier
const [currentTab, setCurrentTab] = useState<'tableau' | 'recap'>('tableau');

const handleTabChange = (tab: 'tableau' | 'recap') => {
  setCurrentTab(tab);

  if (tab === 'recap') {
    // Refetch les Ã©vÃ©nements cÃ´tÃ© SWR
    mutate(`/api/roadshow/${projectId}/events?week=${selectedWeek}&year=${selectedYear}`);
  }
};
2. ğŸ§© Boutons dâ€™onglet
tsx
Copier
Modifier
<div className="flex gap-2 mb-4">
  <button
    onClick={() => handleTabChange('tableau')}
    className={`btn ${currentTab === 'tableau' ? 'btn-primary' : 'btn-outline'}`}
  >
    Vue tableau
  </button>
  <button
    onClick={() => handleTabChange('recap')}
    className={`btn ${currentTab === 'recap' ? 'btn-primary' : 'btn-outline'}`}
  >
    RÃ©capitulatif
  </button>
</div>
3. ğŸ“¦ Chargement conditionnel des vues
tsx
Copier
Modifier
{currentTab === 'tableau' && <RoadshowTable />}
{currentTab === 'recap' && (
  <RoadshowRecap
    projectId={projectId}
    selectedWeek={selectedWeek}
    selectedYear={selectedYear}
  />
)}
4. ğŸ“ˆ Composant RoadshowRecap.tsx
Ajoute le SWR comme ceci :

tsx
Copier
Modifier
const { data, error, isLoading } = useSWR(
  `/api/roadshow/${projectId}/events?week=${selectedWeek}&year=${selectedYear}`
);
Et affiche un loader si besoin :

tsx
Copier
Modifier
if (isLoading) return <div>Chargement du rÃ©capitulatif...</div>;
âœ… RÃ©sultat attendu
Chaque fois que tu passes de "Vue tableau" â†’ "RÃ©capitulatif", les Ã©vÃ©nements sont auto-refresh

Plus besoin de revenir au dashboard

DonnÃ©es toujours Ã  jour ğŸ’¯

