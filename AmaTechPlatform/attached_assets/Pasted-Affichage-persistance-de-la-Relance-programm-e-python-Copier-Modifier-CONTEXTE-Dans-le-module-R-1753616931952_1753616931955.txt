Affichage & persistance de la Relance programmÃ©e
python
Copier
Modifier
ğŸ¯ CONTEXTE
Dans le module Roadshow, lorsqu'on programme une relance via la modale (cf. screenshot), l'information est bien stockÃ©e en tant quâ€™Ã©vÃ©nement `followup`.  
Mais **la date de prochaine relance (relance programmÃ©e)** a disparu du tableau principal. On veut la **rÃ©afficher, la stocker, et la rÃ©utiliser ailleurs (to-do list)**.

---

### âœ… Objectif

#### 1. ğŸ”¢ Calcul automatique
Au moment de la crÃ©ation dâ€™une relance (`roadshow_event` type `followup`) :
- Calculer la date `relance_programmee` = **date relance + 5 jours**
- Stocker cette info dans la table `roadshow_counterparty.next_followup_date`

âš ï¸ Si plusieurs relances existent : on stocke la **plus proche** dans le futur (min).

#### 2. ğŸ§± Backend â€” Drizzle

```ts
// roadshow_counterparty.ts
next_followup_date: pg.date("next_followup_date")
Lors dâ€™un INSERT ou DELETE dâ€™un event de type followup, dÃ©clencher un recalcul automatique cÃ´tÃ© backend, exemple :

ts
Copier
Modifier
await db
  .select({ date: roadshowEvent.date })
  .from(roadshowEvent)
  .where(and(
    eq(roadshowEvent.counterpartyId, counterpartyId),
    eq(roadshowEvent.type, 'followup'),
    gte(roadshowEvent.date, today)
  ))
  .orderBy(roadshowEvent.date)
  .limit(1)

await db
  .update(roadshowCounterparty)
  .set({ nextFollowupDate: found?.date ?? null })
  .where(eq(roadshowCounterparty.id, counterpartyId))
3. ğŸ“Š Frontend
a. Colonne â€œRelance prog.â€
Titre : Relance prog.

Format : ğŸ“… jj/mm/aaaa

Affiche la valeur de next_followup_date

Si null â†’ affiche â€œâ€“â€

b. Affichage Ã  part (plus tard)
Cette donnÃ©e sera utilisÃ©e dans :

Lâ€™onglet To-do List

Les alertes mail

ğŸ” Endpoints concernÃ©s :
POST /roadshow/events (type = followup)

Doit mettre Ã  jour automatiquement next_followup_date aprÃ¨s insertion

DELETE /roadshow/events/:id

Doit recalculer et MAJ next_followup_date si lâ€™event supprimÃ© Ã©tait un followup

âœ… UX :

Lorsque je programme une relance â†’ affichÃ©e dans la colonne Relance prog.

La colonne est en lecture seule

Lorsquâ€™on supprime une relance â†’ mise Ã  jour immÃ©diate de la colonne

ğŸ§± Stack : React (frontend) â€“ Node.js + Drizzle (backend) â€“ PostgreSQL (base).