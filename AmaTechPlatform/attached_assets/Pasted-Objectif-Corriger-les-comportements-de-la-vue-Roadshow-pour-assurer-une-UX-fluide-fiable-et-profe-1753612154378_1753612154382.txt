Objectif :
Corriger les comportements de la vue Roadshow pour assurer une UX fluide, fiable et professionnelle.

ğŸ› ï¸ 1. Interactions : compteur dynamique
ProblÃ¨me : le nombre dâ€™interactions ne se met Ã  jour quâ€™aprÃ¨s reload complet de la page.

Ã€ faire :

Lorsque l'utilisateur ajoute une nouvelle interaction (roadshow_event de type interaction), mettre Ã  jour localement le compteur (en front, sans reload)

Solution : stocker un interactionCount dans le useState ou Zustand, et lâ€™incrÃ©menter aprÃ¨s POST rÃ©ussi

Ou re-fetch les Ã©vÃ©nements de cette contrepartie avec await mutate() ou refetch() si tu utilises SWR / React Query

ğŸ› ï¸ 2. Teaser / NDA / IM / BP : UX de modification
ProblÃ¨me : les champs ne donnent pas dâ€™indication quâ€™ils sont modifiables aprÃ¨s ajout ; pas de feedback utilisateur.

Ã€ faire :

Lorsquâ€™une date est saisie, afficher le champ en lecture seule (ex: 01/07/2025) avec une icÃ´ne âœï¸ ou bouton â€œmodifierâ€

Clic sur âœï¸ â†’ repasse en mode date picker

Enregistrer via fetch (POST roadshow_event) et afficher un toast.success("Teaser enregistrÃ©")

AmÃ©lioration UX :

tsx
Copier
Modifier
{!editMode ? (
  <div className="flex items-center gap-2">
    <span>{format(date)}</span>
    <button onClick={() => setEditMode(true)}><EditIcon /></button>
  </div>
) : (
  <input type="date" value={...} onChange={...} />
)}
ğŸ› ï¸ 3. Phase 2 : toggle non fonctionnel
ProblÃ¨me : cocher la case â€œPhase 2â€ ne dÃ©clenche rien.

Ã€ faire :

Ajouter une fonction handleTogglePhase2(counterpartyId) :

ts
Copier
Modifier
const handleTogglePhase2 = async (checked: boolean) => {
  const res = await fetch(`/api/roadshow/${id}/phase2`, {
    method: "POST",
    body: JSON.stringify({ phase2_ok: checked }),
    headers: { "Content-Type": "application/json" },
  });
  if (res.ok) {
    toast.success("Phase 2 mise Ã  jour");
    refresh();
  }
};
Et cÃ´tÃ© backend :

ts
Copier
Modifier
app.post("/api/roadshow/:id/phase2", async (req, res) => {
  const counterpartyId = parseInt(req.params.id);
  const { phase2_ok } = req.body;

  await db
    .insert(roadshow_phase2)
    .values({ counterparty_id: counterpartyId, phase2_ok })
    .onConflictDoUpdate({
      target: roadshow_phase2.counterparty_id,
      set: { phase2_ok },
    });

  res.status(200).json({ success: true });
});
âœ… RÃ©sumÃ©
Ã‰lÃ©ment	Ã€ corriger / amÃ©liorer
Interactions	Compteur live (pas reload page)
Teaser/NDAâ€¦	UX : affichage readonly + âœï¸
Phase 2	Sauvegarde backend + affichage dataroom/binding si activÃ©