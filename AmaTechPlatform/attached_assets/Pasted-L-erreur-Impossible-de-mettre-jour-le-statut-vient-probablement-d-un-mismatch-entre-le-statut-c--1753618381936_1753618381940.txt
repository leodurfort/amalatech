Lâ€™erreur "Impossible de mettre Ã  jour le statut" vient probablement dâ€™un mismatch entre le statut cÃ´tÃ© React ("Live", "En attente", "No-go") et la valeur enregistrÃ©e dans la base (probablement "Waiting", "Live", "No-go" â€” ou encore dâ€™un casing ou espace mal formatÃ©).

âœ… Ã‰tapes pour corriger proprement
1. ğŸ” VÃ©rifie les valeurs rÃ©ellement enregistrÃ©es en base dans la colonne statut de roadshow_counterparty.
ExÃ©cute une requÃªte directe :

sql
Copier
Modifier
SELECT DISTINCT statut FROM roadshow_counterparty;
Cela va te montrer si tu as "Waiting" au lieu de "En attente", ou "live" au lieu de "Live", etc.

2. ğŸ” Corrige le if dans le POST /:counterpartyId/status backend :
Actuel :

ts
Copier
Modifier
if (!['Live', 'En attente', 'No-go'].includes(newStatus)) {
CorrigÃ© avec normalisation simple :

ts
Copier
Modifier
const validStatuses = {
  live: 'Live',
  attente: 'En attente',
  nogo: 'No-go',
  'no-go': 'No-go',
};

const key = newStatus.trim().toLowerCase().replace(/\s+/g, '').replace('-', '');
const formattedStatus = validStatuses[key];

if (!formattedStatus) {
  return res.status(400).json({ error: 'Statut invalide' });
}

// update statut
await db.update(roadshow_counterparty)
  .set({ statut: formattedStatus })
  .where(eq(roadshow_counterparty.id, parseInt(counterpartyId)));

// event log
await db.insert(roadshow_event).values({
  counterparty_id: parseInt(counterpartyId),
  type: 'status_change',
  date: new Date(),
  meta: { newStatus: formattedStatus },
});

res.json({ success: true });
3. ğŸ”„ CÃ´tÃ© Frontend : assure-toi que le newStatus envoyÃ© est bien "Live", "En attente" ou "No-go"
Si tu passes les labels depuis un Select, fais bien attention Ã  la value. Exemple :

tsx
Copier
Modifier
<Select
  value={statut}
  onValueChange={(value) => handleStatusChange(value)}
>
  <SelectItem value="Live">ğŸŸ¢ Live</SelectItem>
  <SelectItem value="En attente">ğŸŸ¡ En attente</SelectItem>
  <SelectItem value="No-go">ğŸ”´ No-go</SelectItem>
</Select>
âœ… Bonus : ajoute un console.log(newStatus) dans handleStatusChange pour vÃ©rifier le format transmis.
