Prompt Replit â€” Enrichissement des formulaires Projet (CrÃ©ation & Ã‰dition)
markdown
Copier
Modifier
ğŸ¯ Objectif :
Enrichir les formulaires "CrÃ©er un projet" et "Modifier un projet" dans AmaTech avec deux nouveaux blocs :
1. Ã‰quipe interne (autocomplÃ©tion)
2. Bloc Mandat (admin uniquement, avec pipeline + simulateur pondÃ©rÃ©)

---

## ğŸ”¹ 1. Bloc Ã‰quipe interne (pour tous les utilisateurs)

Ajoute un champ `membresEquipe` dans le formulaire, permettant de sÃ©lectionner plusieurs collaborateurs internes Amala.

ğŸ”§ Comportement souhaitÃ© :
- Champ libre avec suggestions (autocomplÃ©tion, type combobox)
- Par exemple : je tape "Ze" â†’ suggestion â€œZed Douzeâ€
- Design esthÃ©tique, mÃªme avec une longue liste (50+ noms)
- Utilise un composant adaptÃ© comme `Combobox`, `Command`, ou `Autocomplete` (shadcn/ui, Headless UI, Downshift)

ğŸ“¤ Stocker les membres sous forme de tableau :
```ts
membresEquipe: [ "Zed Douze", "Claire Marchand" ]
âš ï¸ Si l'utilisateur courant est sÃ©lectionnÃ©, il ne doit pas pouvoir se supprimer lui-mÃªme.

ğŸ”’ 2. Bloc "Mandat" (visible uniquement si user.role === 'admin')
Ajoute un bloc sous les champs habituels, visible uniquement pour les admins.

Contenu du bloc :

ğŸ’° Calcul des fees (identique au simulateur)
hasRetainer + retainerMontant

hasFlatFee + flatFeeMontant

successFeePourcentage + base (VE/VT)

accÃ©lÃ©rateurs[] (seuil + % + base) â€” max 5

ğŸ” Nouveau champ : Pipeline
pipelinePourcentage (nombre, input entre 0 et 100)

Label : â€œPondÃ©ration pipeline (en %)â€

Placeholder : â€œEx. : 80â€

Aide : â€œPermet dâ€™ajuster la valeur VE/VT retenue pour simuler les fees (probabilitÃ© de signature, etc.)â€

ğŸ“¤ Ã€ stocker :

ts
Copier
Modifier
pipeline: {
  pondÃ©ration: 80 // en %
}
âš™ï¸ Simulateur mis Ã  jour (sous le champ pipeline)
Input :

valeurVEVT (nombre, ex: 30 000 000)

Affichage dynamique :

PondÃ©ration appliquÃ©e : valeurEffective = valeurVEVT Ã— pipelinePourcentage / 100

Affiche :

yaml
Copier
Modifier
Valeur pondÃ©rÃ©e retenue : 24 000 000 â‚¬
Total des fees estimÃ©s : 430 000 â‚¬ (soit 1,79 % de la VE)
ğŸ’¡ Cette valeur sera utilisÃ©e plus tard dans une page "Pipeline globale"

ğŸ§  Structure JSON backend
Met Ã  jour ton modÃ¨le Projet :

ts
Copier
Modifier
{
  nomClient: string,
  nomCode?: string,
  membresEquipe: string[],
  conditionsEconomiques: {
    retainer?: number,
    flatFee?: number,
    successFeePourcentage?: number,
    successFeeBase?: "VE" | "VT",
    accelerateurs?: [
      {
        seuil: number,
        pourcentage: number,
        base: "VE" | "VT"
      }
    ]
  },
  pipeline: {
    pondÃ©ration: number // 0â€“100
  }
}
âœ… Comportement attendu
Le champ Ã©quipe est fluide, rapide Ã  chercher, agrÃ©able Ã  lâ€™Å“il

Le bloc Mandat nâ€™apparaÃ®t que pour les admins

Le simulateur est mis Ã  jour en temps rÃ©el selon la pondÃ©ration

Toutes les donnÃ©es sont bien stockÃ©es et modifiables depuis la page "Modifier projet"